---
title: Сведения о подключении Azure Data Lake Storage 2-го поколения к Power BI для хранения потока данных
description: Перенесите свои данные в потоки данных с помощью Azure Data Lake Storage 2-го поколения
author: davidiseminger
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-service
ms.topic: conceptual
ms.date: 12/16/2019
ms.author: davidi
LocalizationGroup: Data from files
ms.openlocfilehash: c3f703bfe2685166ce575b37c053b2a9603a799f
ms.sourcegitcommit: 02b05932a119527f255e1eacc745a257044e392f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/19/2019
ms.locfileid: "75223878"
---
# <a name="connect-azure-data-lake-storage-gen2-for-dataflow-storage"></a>Подключение Azure Data Lake Storage 2-го поколения для хранения потоков данных

Вы можете настроить рабочую область Power BI для хранения потоков данных в корпоративной учетной записи Azure Data Lake Storage 2-го поколения. В этой статье описаны необходимые шаги, а также предоставлены инструкции и рекомендации. Настройка рабочих областей для хранения определений потоков и файлов данных в вашем озере данных обеспечивает ряд преимуществ, включая следующие:

* Azure Data Lake Storage 2-го поколения предоставляет чрезвычайно масштабируемое хранилище для данных.
* С помощью данных и файлов определений потоков данных разработчики вашего ИТ-отдела могут использовать службы данных Azure и искусственного интеллекта (ИИ), как показано в [примерах для служб данных Azure на сайте GitHub](https://aka.ms/cdmadstutorial)
* Разработчики в вашей организации могут интегрировать данные потоков данных во внутренние приложения и бизнес-решения, используя ресурсы для разработчиков потоков данных и Azure.

Чтобы использовать Azure Data Lake Storage 2-го поколения для потоков данных, необходимы следующие компоненты:

* **Клиент Power BI.** По крайней мере одна учетная запись в клиенте Azure Active Directory (AAD) должна быть зарегистрирована для Power BI.
* **Учетная запись глобального администратора.** Эта учетная запись необходима, чтобы подключить и настроить Power BI для хранения определения потока данных и данных в вашей учетной записи Azure Data Lake Storage 2-го поколения.
* **Подписка Azure.** Подписка Azure необходима для использования Azure Data Lake Storage 2-го поколения.
* **Группа ресурсов.** Используйте уже имеющуюся группу ресурсов или создайте новую.
* **Учетная запись хранения Azure с включенной функцией Data Lake Storage 2-го поколения** 

> [!TIP]
> Если у вас нет подписки Azure, перед началом работы [создайте бесплатную учетную запись](https://azure.microsoft.com/free/).

> [!WARNING]
> Место хранения потока данных нельзя изменить после настройки. Другие важные замечания см. в разделе [Рекомендации и ограничения](#considerations-and-limitations) в конце этой статьи.

## <a name="prepare-your-azure-data-lake-storage-gen2-for-power-bi"></a>Подготовка Azure Data Lake Storage 2-го поколения для Power BI

Перед настройкой Power BI с учетной записью Azure Data Lake Storage 2-го поколения необходимо создать и настроить учетную запись хранения. Требования для Power BI:

1. Учетная запись хранения должна быть создана в том же клиенте AAD, что и ваш клиент Power BI.
2. Учетная запись хранения должна быть создана в том же регионе, что и ваш клиент Power BI. Сведения об определении расположения клиента Power BI см. в [этой статье](service-admin-where-is-my-tenant-located.md).
3. Для учетной запись хранения необходимо включить функцию *Иерархическое пространство имен*.
4. Службе Power BI необходимо предоставить роль *читателя* в учетной записи хранения.
5. Необходимо создать файловую систему с именем **powerbi**.
6. Для созданной вами файловой системы **powerbi** необходимо авторизовать службы Power BI.

В следующих разделах подробно описаны шаги настройки учетной записи Azure Data Lake Storage 2-го поколения.

### <a name="create-the-storage-account"></a>Создание учетной записи хранения

Выполните действия, описанные в [этой статье](https://docs.microsoft.com/azure/storage/blobs/data-lake-storage-quickstart-create-account).

1. Убедитесь, что вы выбрали расположение своего клиента Power BI, и в качестве хранилища укажите **StorageV2 (общего назначения версии 2)** .
2. Включите функцию иерархического пространства имен.
3. Рекомендуем установить для параметра репликации значение **Геоизбыточное хранилище с доступом на чтение (RA-GRS)** .

### <a name="grant-the-power-bi-service-a-reader-role"></a>Предоставление службе Power BI роли читателя

Затем предоставьте службе Power BI роль читателя в созданной учетной записи хранения. Это встроенная роль, поэтому процедура проста. 

Выполните действия, описанные в руководстве по [назначению встроенной роли RBAC](https://docs.microsoft.com/azure/storage/common/storage-auth-aad-rbac#assign-a-built-in-rbac-role).

В окне **Добавление назначения ролей** выберите роль **Читатель**, чтобы назначить ее службе Power BI. Затем найдите **службу Power BI**. На следующем рисунке показана роль **Читатель**, назначенная службе Power BI.

![Служба Power BI с назначенной ролью читателя](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_05.jpg)


> [!NOTE]
> Подождите не менее 30 минут, чтобы разрешение на портале появилось в службе Power BI. Каждый раз при изменении разрешений на портале ожидайте 30 минут для их отображения в Power BI. 


### <a name="create-a-file-system-for-power-bi"></a>Создание файловой системы для Power BI

Перед добавлением учетной записи хранения в Power BI необходимо создать файловую систему с именем *powerbi*. Существует много способов создания такой файловой системы, включая использование Azure Databricks, HDInsight, AZCopy или Обозревателя службы хранилища Azure. В этом разделе описан простой способ создания файловой системы с помощью Обозревателя службы хранилища Azure.

Для этого шага необходимо установить Обозреватель службы хранилища Azure версии 1.6.2 или более поздней. Сведения об установке Обозревателя для Windows, Macintosh или Linux см. в статье [Обозреватель хранилища Azure](https://azure.microsoft.com/features/storage-explorer/).

1. После установки при первом запуске откроется окно Microsoft Azure Storage Explorer — Connect (Обозреватель службы хранилища Microsoft Azure — подключение). Несмотря на то, что Обозреватель службы хранилища предоставляет несколько способов подключения к учетным записям хранения, в настоящее время поддерживается только один способ для требуемой настройки. 

2. На левой панели найдите и разверните созданную ранее учетную запись хранения.

3. Щелкните правой кнопкой мыши контейнеры больших двоичных объектов и в контекстном меню выберите "Создать контейнер BLOB-объектов".

   ![выбор контейнеров BLOB-объектов](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_05a.jpg)

4. Под папкой контейнеров больших двоичных объектов появится текстовое поле. Введите имя *powerbi*. 

   ![ввод имени powerbi](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_05b.jpg)

5. После этого нажмите клавишу ВВОД, чтобы создать контейнер больших двоичных объектов.

   ![создание контейнера больших двоичных объектов с помощью клавиши ВВОД](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_05c.jpg)

В следующем разделе вы предоставите семейству служб Power BI полный доступ к созданной вами файловой системе. 

### <a name="grant-power-bi-permissions-to-the-file-system"></a>Предоставление разрешений Power BI для доступа к файловой системе

Чтобы предоставить разрешения файловой системе, примените параметры списка управления доступом (ACL), которые предоставляют доступ к службе Power BI. Первым шагом является получение удостоверения служб Power BI у вашего клиента. Вы можете просмотреть свои приложения Azure Active Directory (AAD) в разделе **корпоративных приложений** на портале Azure.

Чтобы найти приложения клиентов, выполните следующие действия:

1. На [портале Azure](https://portal.azure.com/) в области навигации выберите **Azure Active Directory**.
2. В колонке Azure **Active Directory** выберите **Корпоративные приложения**.
3. В раскрывающемся меню **Тип приложения** выберите **Все приложения**, а затем щелкните **Применить**. Отобразится пример ваших приложений клиентов, аналогичный следующему.

    ![Корпоративные приложения AAD](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_06.jpg)

4. В строке поиска введите *Power*, и появится коллекция идентификаторов объектов для приложений Power BI и Power Query. Эти три значения понадобятся на следующих шагах.  

    ![Поиск приложений Power](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_07.jpg)

5. В результатах поиска выберите и скопируйте идентификаторы объектов для служб Power BI Premium и Power Query Online. Эти значения понадобятся для вставки на следующих шагах.

6. Затем с помощью **Обозревателя службы хранилища Azure** перейдите к файловой системе *powerbi*, созданной в предыдущем разделе. Выполните инструкции, представленные в разделе [Managing access](https://docs.microsoft.com/azure/storage/blobs/data-lake-storage-how-to-set-permissions-storage-explorer#managing-access) (Управление доступом) в статье [Set file and directory level permissions using Azure Storage Explorer with Azure Data Lake Storage Gen2 (Preview)](https://docs.microsoft.com/azure/storage/blobs/data-lake-storage-how-to-set-permissions-storage-explorer) (Настройка разрешений уровня файлов и каталогов с помощью обозревателя службы хранилища Azure и Azure Data Lake Storage 2-го поколения).

7. Для каждого из двух идентификаторов объектов Power BI Premium, собранных на шаге 5, назначьте списки управления доступом по умолчанию и доступ на **чтение**, **запись** и **выполнение** в своей файловой системе *powerbi*.

   ![назначение трех списков для двух ИД](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_07a.jpg)

8. Для идентификатора объекта Power Query Online, собранного на шаге 4, назначьте списки управления доступом по умолчанию и доступ на **запись** и **выполнение** в своей файловой системе *powerbi*.

   ![последующее назначение записи и выполнения](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_07b.jpg)

9. Кроме того, для **других** также назначьте список управления доступом по умолчанию и доступ на **выполнение**.

    ![назначение выполнения для других](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_07c.jpg)

## <a name="connect-your-azure-data-lake-storage-gen2-to-power-bi"></a>Подключение Azure Data Lake Storage 2-го поколения к Power BI

После настройки учетной записи Azure Data Lake Storage 2-го поколения на портале Azure подключите ее к Power BI на **портале администрирования Power BI**. Кроме того, вы можете управлять хранилищем потоков данных Power BI в разделе параметров **хранилища потоков данных** на портале администрирования Power BI. Инструкции по запуску и базовому использованию см. в статье [Портал администрирования Power BI](service-admin-portal.md).

Подключить **учетную запись Azure Data Lake Storage 2-го поколения** можно следующим образом:

1. На **портале администрирования Power BI** перейдите на вкладку **Параметры потоков данных**.

    ![Портал администрирования Power BI](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-08b.png) 

2. Нажмите кнопку **Подключить Azure Data Lake Storage 2-го поколения**. Появляется следующее окно.

    ![Azure Data Lake Storage 2-го поколения](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_09.jpg) 

3. Укажите **идентификатор подписки** учетной записи хранения.
4. Укажите **имя группы ресурсов**, в которой была создана учетная запись хранения.
5. Укажите **имя учетной записи хранения**.
6. Нажмите кнопку **Подключиться**.

После успешного выполнения этих шагов ваша учетная запись Azure Data Lake Storage 2-го поколения будет подключена к Power BI. 

> [!NOTE]
> Чтобы настроить подключение к Azure Data Lake Storage 2-го поколения на портале администрирования Power BI, необходимо иметь разрешения глобального администратора. При этом глобальные администраторы не могут подключаться к внешнему хранилищу на портале администрирования.  

Затем вам нужно будет разрешить сотрудникам вашей организации настраивать свои рабочие пространства, что позволит им использовать данную учетную запись хранения для определения потока данных и хранения данных. Мы сделаем это в следующем разделе. 


## <a name="allow-admins-to-assign-workspaces"></a>Разрешение администраторам назначать рабочие области

По умолчанию определение потока данных и файлы данных хранятся в хранилище, предоставленном Power BI. Чтобы получить доступ к файлам потока данных в вашей учетной записи хранения, администраторы рабочей области должны сначала настроить рабочую область для разрешения назначения и хранения потоков данных в новой учетной записи хранения. Для настройки параметров хранилища потока данных администратору рабочей области необходимо предоставить разрешения на назначение хранилища на **портале администрирования Power BI**.

Чтобы предоставить разрешения на назначение хранилища, перейдите на вкладку **Параметры потока данных** на **портале администрирования Power BI**. Для переключателя *Allow workspace admins to assign workspaces to this storage account* (Разрешение администраторам рабочих областей назначать области этой учетной записи хранения) необходимо установить значение **Разрешить**. Включив этот ползунок, нажмите кнопку **Применить**, чтобы изменения вступили в силу. 

![Разрешение администраторам назначать рабочие области](media/service-dataflows-connect-azure-data-lake-storage-gen2/dataflows-connect-adlsg2_10.jpg) 

Вот и все. Теперь администраторы рабочей области Power BI могут назначать рабочие процессы созданной вами файловой системе.


## <a name="considerations-and-limitations"></a>Рекомендации и ограничения

Эта функция находится в режиме предварительного версии, и ее поведение может измениться. При работе с хранилищем потока данных следует учитывать несколько рекомендаций и ограничений:

* Место хранения потока данных нельзя изменить после настройки.
* Только владельцы потока данных, хранящегося в Azure Data Lake Storage 2-го поколения, могут получить доступ к его данным по умолчанию. Чтобы авторизовать дополнительных пользователей для потоков данных, хранящихся в Azure, необходимо добавить их в папку CDM потока данных. 
* Создание потоков данных со связанными сущностями возможно, только если они хранятся в одной учетной записи хранения.
* Локальные источники данных в общедоступных емкостях Power BI не поддерживаются в потоках данных, хранящихся в озере данных вашей организации.
* Моментальные снимки не удаляются автоматически в ADLS 2-го поколения. Если вы хотите освободить пространство, можно создать функцию Azure для периодической очистки старых моментальных снимков.

В этом разделе описаны некоторые известные проблемы.

У пользователей Power BI Desktop нет доступа к потокам данных, которые хранятся в **учетной записи Azure Data Lake Storage**, если они являются владельцами потока данных, или им разрешен доступ к папке CDM в озере. Ниже описана последовательность действий, которая к этому приводит.

1. Анна создала новую рабочую область и настроила ее для хранения потоков данных в озере данных организации. 
2. Бен, который также является членом рабочей области, которую создала Анна, хочет с помощью Power BI Desktop и соединителя потока данных получить данные из потока данных, созданного Анной.
3. У Бена возникает аналогичная ошибка, потому что ему не предоставили доступ к папке CDM потока данных в озере.

Распространенные вопросы и ответы:

**Вопрос.** Могу ли я изменить место хранения созданных ранее потоков данных в рабочей области?

**Ответ.** Вы не можете изменить место хранения потока данных после его создания. 

**Вопрос.** Когда я могу изменить место хранения потока данных в рабочей области?

**Ответ.** Изменение места хранения потока данных в рабочей области разрешено, только если рабочая область не содержит потоков данных.


## <a name="next-steps"></a>Дальнейшие действия

В этой статье приведены инструкции по подключению Azure Data Lake 2-го поколения для хранения потоков данных. Дополнительные сведения вы найдете в перечисленных ниже статьях.

Дополнительные сведения о потоках данных, CDM и Azure Data Lake Storage 2-го поколения см. в следующих статьях:

* [Потоки данных и интеграция Azure Data Lake (предварительная версия)](service-dataflows-azure-data-lake-integration.md)
* [Настройка параметров потоков данных рабочей области (предварительная версия)](service-dataflows-configure-workspace-storage-settings.md)
* [Добавление папки CDM в Power BI в виде потока данных (предварительная версия)](service-dataflows-add-cdm-folder.md)

Общие сведения о потоках данных см. в этих статьях:

* [Creating and using dataflows in Power BI (Preview)](service-dataflows-create-use.md) (Создание и использование потоков данных в Power BI (предварительная версия))
* [Использование вычисляемых сущностей в Power BI Premium](service-dataflows-computed-entities-premium.md)
* [Использование потоков данных с локальными источниками данных](service-dataflows-on-premises-gateways.md)
* [Ресурсы для разработчиков потоков данных Power BI](service-dataflows-developer-resources.md)

Дополнительные сведения о службе хранилища Azure см. в следующих статьях:
* [Руководство по безопасности службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-security-guide)

Дополнительные сведения о модели общих данных вы найдете в этой обзорной статье:
* [Что такое модель общих данных?](https://docs.microsoft.com/powerapps/common-data-model/overview)
* [Папки CDM](https://go.microsoft.com/fwlink/?linkid=2045304)
* [The metadata file (model.json) for the Common Data Model](https://go.microsoft.com/fwlink/?linkid=2045521) (Файл метаданных (model.json) для модели общих данных)

Вы всегда можете [задать вопросы в Сообществе Power BI](https://community.powerbi.com/).
